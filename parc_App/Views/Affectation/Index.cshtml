@model List<parc_App.ViewModel.MaterielAffectationViewModel>
@{
    ViewData["Title"] = "Liste des matériels";
}

<div class="container-xl">
    <div class="table-responsive">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
                        <h2>Liste <b>des affectations</b></h2>
                    </div>
                </div>
            </div>

            <!-- Formulaire de filtrage -->
            <form asp-action="Index" method="get" class="mb-3" id="filterForm">
                <div class="row">
                    <div class="col-auto">
                        <select name="typeMateriel" class="form-select" id="typeMaterielSelect" asp-items="ViewBag.TypeMaterielOptions">
                            <option value="">Tous les types</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <select name="etat" class="form-select" id="etatSelect" asp-items="ViewBag.EtatOptions">
                            <option value="">Tous les états</option>
                        </select>
                    </div>
                </div>
            </form>

            <table class="table table-striped table-hover table-bordered">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Marque</th>
                        <th>Modèle</th>
                        <th>État</th>
                        <th>Preneur</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var materiel in Model)
                    {
                        <tr>
                            <td>@materiel.TypeMateriel</td>
                            <td>@materiel.Marque</td>
                            <td>@materiel.Modele</td>
                            <td>
                                @if (materiel.Etat == "Amorti")
                                {
                                    <span class="text-danger">@materiel.Etat</span>
                                }
                                else
                                {
                                    @materiel.Etat
                                }
                            </td>
                            <td>@(string.IsNullOrEmpty(materiel.PreneurNomComplet) ? "Non attribué" : materiel.PreneurNomComplet)</td>
                            <td>
                                <a asp-action="Affecter"
                                   asp-route-id="@materiel.MaterielId"
                                   class="btn btn-primary btn-sm @(materiel.Etat == "Amorti" ? "disabled" : "")">
                                    Affecter
                                </a>
                                <a asp-action="Historique"
                                   asp-route-id="@materiel.MaterielId"
                                   class="btn btn-info btn-sm">
                                    Historique
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- Pagination -->
            <nav aria-label="Pagination">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1, typeMateriel = ViewBag.SelectedTypeMateriel, etat = ViewBag.SelectedEtat })">Précédent</a>
                    </li>

                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                    {
                        <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = i, typeMateriel = ViewBag.SelectedTypeMateriel, etat = ViewBag.SelectedEtat })">@i</a>
                        </li>
                    }

                    <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1, typeMateriel = ViewBag.SelectedTypeMateriel, etat = ViewBag.SelectedEtat })">Suivant</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger mt-2">
        @TempData["Error"]
    </div>
}

<style>
    body {
        color: #566787;
        background: #f5f5f5;
        font-family: 'Varela Round', sans-serif;
        font-size: 13px;
    }

    .table-responsive {
        margin: 30px 0;
        overflow-x: auto;
    }

    .table-wrapper {
        background: #fff;
        padding: 20px 25px;
        border-radius: 3px;
        box-shadow: 0 1px 1px rgba(0,0,0,0.05);
        width: 100%;
    }

    .table-title {
        padding-bottom: 15px;
        background: #435d7d;
        color: #fff;
        padding: 16px 30px;
        margin: -20px -25px 10px;
        border-radius: 3px 3px 0 0;
    }

        .table-title h2 {
            margin: 5px 0 0;
            font-size: 24px;
        }

        .table-title .btn {
            color: #fff;
            float: right;
            font-size: 13px;
            background: #2196F3;
            border: none;
            min-width: 50px;
            border-radius: 2px;
            margin-left: 10px;
        }

    .table td i {
        font-size: 19px;
    }

    .table td a {
        color: #566787;
        text-decoration: none;
    }

        .table td a.edit {
            color: #FFC107;
        }

        .table td a.delete {
            color: #F44336;
        }

        .table td a:hover {
            color: #2196F3;
        }

    .table .btn-sm {
        padding: 2px 6px;
        font-size: 12px;
    }
</style>

@section Scripts {
    <script>
        // Auto-submit form when dropdown changes
        document.getElementById('typeMaterielSelect').addEventListener('change', function () {
            document.getElementById('filterForm').submit();
        });
        document.getElementById('etatSelect').addEventListener('change', function () {
            document.getElementById('filterForm').submit();
        });
    </script>
}
